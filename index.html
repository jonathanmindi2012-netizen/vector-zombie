<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Zombie Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body {
  margin: 0;
  background: black;
  color: #0f0;
  font-family: Arial;
  overflow: hidden;
}
#lobby, #game {
  position: absolute;
  width: 100%;
  height: 100%;
}
#lobby {
  padding: 20px;
}
button {
  width: 100%;
  padding: 15px;
  margin-top: 10px;
  font-size: 18px;
  background: #0f0;
  border: none;
}
label {
  display: block;
  margin-top: 10px;
}
canvas {
  background: #111;
  display: block;
  margin: auto;
}
#skills {
  position: absolute;
  bottom: 10px;
  width: 100%;
  display: flex;
  justify-content: space-around;
}
.skill {
  width: 45%;
  background: #222;
  color: #0f0;
}
</style>
</head>

<body>

<!-- LOBBY -->
<div id="lobby">
  <h1>ðŸ§Ÿ Zombie Game</h1>

  <label>Sensibilidad
    <input type="range" id="sens" min="0.5" max="3" step="0.1">
  </label>

  <label>Brillo
    <input type="range" id="bright" min="0.5" max="2" step="0.1">
  </label>

  <label>Calidad
    <select id="quality">
      <option value="1">Baja</option>
      <option value="2">Media</option>
      <option value="3">Alta</option>
    </select>
  </label>

  <button onclick="startGame()">JUGAR</button>
</div>

<!-- GAME -->
<div id="game" style="display:none">
  <canvas id="canvas" width="360" height="640"></canvas>

  <div id="skills">
    <button class="skill" onclick="raySkill()">âš¡ RAYO (5)</button>
    <button class="skill" onclick="boomSkill()">ðŸ’¥ BOOM (10)</button>
  </div>
</div>

<script>
// ===== SETTINGS =====
const settings = JSON.parse(localStorage.getItem("settings")) || {
  sens: 1,
  bright: 1,
  quality: 2
};

sens.value = settings.sens;
bright.value = settings.bright;
quality.value = settings.quality;

// ===== VARS =====
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let player, bullets, zombies, kills;
let moveTouch = null;
let rayUsed = false;
let boomUsed = false;

// ===== START =====
function startGame() {
  settings.sens = +sens.value;
  settings.bright = +bright.value;
  settings.quality = +quality.value;
  localStorage.setItem("settings", JSON.stringify(settings));

  document.body.style.filter = `brightness(${settings.bright})`;
  lobby.style.display = "none";
  game.style.display = "block";

  initGame();
}

function initGame() {
  player = { x: 180, y: 520, r: 15, life: 100 };
  bullets = [];
  zombies = [];
  kills = 0;
  rayUsed = false;
  boomUsed = false;

  setInterval(spawnZombie, 1200);
  requestAnimationFrame(loop);
}

// ===== TOUCH =====
canvas.addEventListener("touchstart", e => {
  const t = e.touches[0];
  if (t.clientX < canvas.width / 2) moveTouch = t;
  else shoot(t.clientX, t.clientY);
});

canvas.addEventListener("touchmove", e => {
  if (!moveTouch) return;
  const t = e.touches[0];
  player.x += (t.clientX - moveTouch.clientX) * settings.sens * 0.1;
  player.y += (t.clientY - moveTouch.clientY) * settings.sens * 0.1;
  moveTouch = t;
});

canvas.addEventListener("touchend", () => moveTouch = null);

// ===== SHOOT =====
function shoot(x,y){
  bullets.push({
    x: player.x,
    y: player.y,
    dx: (x-player.x)*0.03,
    dy: (y-player.y)*0.03
  });
}

// ===== ZOMBIES =====
function spawnZombie(){
  zombies.push({
    x: Math.random()*canvas.width,
    y: -20,
    r: 15,
    speed: 0.6 + Math.random()
  });
}

// ===== SKILLS =====
function raySkill(){
  if(kills < 5 || rayUsed) return;
  rayUsed = true;

  zombies = zombies.filter(z => z.x < player.x-10 || z.x > player.x+10);
}

function boomSkill(){
  if(kills < 10 || boomUsed) return;
  boomUsed = true;
  zombies = [];
}

// ===== LOOP =====
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // PLAYER
  ctx.fillStyle="#0f0";
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fill();

  // BULLETS
  ctx.fillStyle="#fff";
  bullets.forEach(b=>{
    b.x+=b.dx; b.y+=b.dy;
    ctx.fillRect(b.x,b.y,4,4);
  });

  // ZOMBIES
  zombies.forEach(z=>{
    const dx=player.x-z.x;
    const dy=player.y-z.y;
    const d=Math.hypot(dx,dy);
    z.x+=(dx/d)*z.speed;
    z.y+=(dy/d)*z.speed;

    ctx.fillStyle="red";
    ctx.beginPath();
    ctx.arc(z.x,z.y,z.r,0,Math.PI*2);
    ctx.fill();
  });

  // COLLISIONS
  bullets.forEach((b,bi)=>{
    zombies.forEach((z,zi)=>{
      if(Math.hypot(b.x-z.x,b.y-z.y)<z.r){
        bullets.splice(bi,1);
        zombies.splice(zi,1);
        kills++;
      }
    });
  });

  zombies.forEach((z,zi)=>{
    if(Math.hypot(player.x-z.x,player.y-z.y)<z.r+player.r){
      zombies.splice(zi,1);
      player.life-=10;
    }
  });

  // HUD
  ctx.fillStyle="#0f0";
  ctx.fillText("â¤ï¸ "+player.life,10,20);
  ctx.fillText("â˜ ï¸ "+kills,10,40);

  if(player.life>0) requestAnimationFrame(loop);
  else ctx.fillText("GAME OVER",130,320);
}
</script>
</body>
</html>
